# 部署在线服务<a name="modelarts_04_0201"></a>

部署在线服务包括：

-   已部署为在线服务的初始化。
-   部署在线服务predictor。
-   部署批量服务transformer。

部署服务返回服务对象Predictor，其属性包括服务管理章节下的所有功能。

## 示例代码<a name="zh-cn_topic_0160619034_section20261580353"></a>

在ModelArts notebook平台中，Session鉴权无需输入鉴权参数。其它平台的Session鉴权请参见[Session鉴权](Session鉴权概述.md)。

-   **方式1：已部署为在线服务predictor的初始化**

    ```
    from modelarts.session import Session
    from modelarts.model import Predictor
    session = Session()
    predictor_instance = Predictor(session, service_id="input your service_id")
    ```


-   **方式2：部署在线服务predictor**

    ```
    from modelarts.session import Session
    from modelarts.model import Model
    from modelarts.config.model_config import ServiceConfig,TransformerConfig 
    session = Session()
    model_instance = Model(session, model_id="input your model_id")
    predictor_instance = model_instance.deploy_predictor( 
                                                 service_name="input service predictor name",
                                                 infer_type="real-time",
                                                 vpc_id="vpc_id",
                                                 subnet_network_id="subnet_network_id ",
                                                 security_group_id="security_group_id",
                                                 configs=configs                # predictor配置参数, 参考下文configs参数格式说明)
    ```

    参数“model\_id“代表将部署成在线服务的模型。“model\_id“可以通过[查询模型列表](查询模型列表.md)或者ModelArts管理控制台获取。


-   <a name="zh-cn_topic_0160619034_li10567114011171"></a>**方式3：部署批量服务transformer**

    ```
    transformer = model_instance.deploy_transformer( 
                                                     service_name="input service transformer name",
                                                     infer_type="batch",
                                                     vpc_id="vpc_id",
                                                     subnet_network_id="subnet_network_id ",
                                                     security_group_id="security_group_id",
                                                     configs=configs            # transformer配置参数, 参考下文configs参数格式说明)
    ```


-   **关于部署在线服务predictor和批量服务transformer时，configs参数格式说明**
    -   部署在线服务predictor时：

        SDK提供了ServiceConfig类对其定义，configs为list，list中的元组对象是ServiceConfig.定义代码如下：

        ```
        configs = []
        service_config1 = ServiceConfig( 
                                         model_id="model_id1",
                                         weight="70",
                                         specification="specification",
                                         instance_count=2,
                                         envs=envs)
        service_config2 = ServiceConfig( 
                                         model_id="model_id2",
                                         weight="30",
                                         specification="specification",
                                         instance_count=2,
                                         envs=envs)
        configs.append(service_config1, service_config2)
        ```

    -   部署批量服务transformer时：

        SDK提供了TransformerConfig类对其定义，configs都是list，list中的元组对象是TransformerConfig.定义代码如下：

        ```
        configs = []
        transformer_config1 = TransformerConfig( 
                                                 model_id="model_id",
                                                 specification="specification",
                                                 instance_count=2,
                                                 src_path="src_path",
                                                 dest_path="dest_path",
                                                 req_uri="req_uri",
                                                 mapping_type="mapping_type",
                                                 mapping_rule="mapping_rule",
                                                 envs=envs)
        configs.append(transformer_config1)
        ```



## 参数说明<a name="zh-cn_topic_0160619034_section18683951918"></a>

**表 1**  参数说明

<a name="zh-cn_topic_0160619034_table16518993181628"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row41524868181628"><th class="cellrowborder" valign="top" width="15.1%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p30350749181639"><a name="zh-cn_topic_0160619034_p30350749181639"></a><a name="zh-cn_topic_0160619034_p30350749181639"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="9.75%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p42491604181639"><a name="zh-cn_topic_0160619034_p42491604181639"></a><a name="zh-cn_topic_0160619034_p42491604181639"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="13.170000000000002%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p19267891181639"><a name="zh-cn_topic_0160619034_p19267891181639"></a><a name="zh-cn_topic_0160619034_p19267891181639"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="61.980000000000004%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p17195363181639"><a name="zh-cn_topic_0160619034_p17195363181639"></a><a name="zh-cn_topic_0160619034_p17195363181639"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row6770181628"><td class="cellrowborder" valign="top" width="15.1%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p8780885181639"><a name="zh-cn_topic_0160619034_p8780885181639"></a><a name="zh-cn_topic_0160619034_p8780885181639"></a>service_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p40163046181639"><a name="zh-cn_topic_0160619034_p40163046181639"></a><a name="zh-cn_topic_0160619034_p40163046181639"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="13.170000000000002%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p31981288181639"><a name="zh-cn_topic_0160619034_p31981288181639"></a><a name="zh-cn_topic_0160619034_p31981288181639"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="61.980000000000004%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p40347522181639"><a name="zh-cn_topic_0160619034_p40347522181639"></a><a name="zh-cn_topic_0160619034_p40347522181639"></a>服务ID，可从ModelArts前端在线服务中获取。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row399025208"><td class="cellrowborder" valign="top" width="15.1%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1992242017"><a name="zh-cn_topic_0160619034_p1992242017"></a><a name="zh-cn_topic_0160619034_p1992242017"></a>session</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p49910292012"><a name="zh-cn_topic_0160619034_p49910292012"></a><a name="zh-cn_topic_0160619034_p49910292012"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="13.170000000000002%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p69922102018"><a name="zh-cn_topic_0160619034_p69922102018"></a><a name="zh-cn_topic_0160619034_p69922102018"></a>Object</p>
</td>
<td class="cellrowborder" valign="top" width="61.980000000000004%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1689152543"><a name="zh-cn_topic_0160619034_p1689152543"></a><a name="zh-cn_topic_0160619034_p1689152543"></a>会话对象，初始化方法见<a href="Session鉴权概述.md">Session鉴权</a>。</p>
</td>
</tr>
</tbody>
</table>

**表 2**  部署在线服务predictor和transformer参数说明

<a name="zh-cn_topic_0160619034_table37462542238"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row57501354122312"><th class="cellrowborder" valign="top" width="15.340000000000002%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p14751165412319"><a name="zh-cn_topic_0160619034_p14751165412319"></a><a name="zh-cn_topic_0160619034_p14751165412319"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="9.75%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p575315411231"><a name="zh-cn_topic_0160619034_p575315411231"></a><a name="zh-cn_topic_0160619034_p575315411231"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="12.85%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p1275435419238"><a name="zh-cn_topic_0160619034_p1275435419238"></a><a name="zh-cn_topic_0160619034_p1275435419238"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="62.06%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p10756175492314"><a name="zh-cn_topic_0160619034_p10756175492314"></a><a name="zh-cn_topic_0160619034_p10756175492314"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row4758654192310"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p47591654132311"><a name="zh-cn_topic_0160619034_p47591654132311"></a><a name="zh-cn_topic_0160619034_p47591654132311"></a>service_name</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p17761854142313"><a name="zh-cn_topic_0160619034_p17761854142313"></a><a name="zh-cn_topic_0160619034_p17761854142313"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p8762155482314"><a name="zh-cn_topic_0160619034_p8762155482314"></a><a name="zh-cn_topic_0160619034_p8762155482314"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p15674133152710"><a name="zh-cn_topic_0160619034_p15674133152710"></a><a name="zh-cn_topic_0160619034_p15674133152710"></a>服务名称，支持1-64位可见字符（含中文），只能以英文大小写字母或者中文字符开头，名称可以包含字母、中文、数字、中划线、下划线。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row197641954112315"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p176625410236"><a name="zh-cn_topic_0160619034_p176625410236"></a><a name="zh-cn_topic_0160619034_p176625410236"></a>description</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p12768115419231"><a name="zh-cn_topic_0160619034_p12768115419231"></a><a name="zh-cn_topic_0160619034_p12768115419231"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p15770145472313"><a name="zh-cn_topic_0160619034_p15770145472313"></a><a name="zh-cn_topic_0160619034_p15770145472313"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p178591840172714"><a name="zh-cn_topic_0160619034_p178591840172714"></a><a name="zh-cn_topic_0160619034_p178591840172714"></a>服务备注，默认为空，不超过100个字符。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row8773165432319"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1477414540232"><a name="zh-cn_topic_0160619034_p1477414540232"></a><a name="zh-cn_topic_0160619034_p1477414540232"></a>infer_type</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1977655415234"><a name="zh-cn_topic_0160619034_p1977655415234"></a><a name="zh-cn_topic_0160619034_p1977655415234"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p12777135420239"><a name="zh-cn_topic_0160619034_p12777135420239"></a><a name="zh-cn_topic_0160619034_p12777135420239"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p11246114246"><a name="p11246114246"></a><a name="p11246114246"></a>推理方式，取值为real-time/batch/edge。默认为real-time。</p>
<a name="ul1765415422419"></a><a name="ul1765415422419"></a><ul id="ul1765415422419"><li>real-time代表在线服务，将模型部署为一个Web Service，并且提供在线的测试UI与监控能力，服务一直保持运行。</li><li>batch为批量服务，批量服务可对批量数据进行推理，完成数据处理后自动停止。</li><li>edge表示边缘服务，通过华为云智能边缘平台，在边缘节点将模型部署为一个Web Service，需提前在IEF（智能边缘服务）创建好节点。</li></ul>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row13340112615168"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p23406263166"><a name="zh-cn_topic_0160619034_p23406263166"></a><a name="zh-cn_topic_0160619034_p23406263166"></a>vpc_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p934052616164"><a name="zh-cn_topic_0160619034_p934052616164"></a><a name="zh-cn_topic_0160619034_p934052616164"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1340726101620"><a name="zh-cn_topic_0160619034_p1340726101620"></a><a name="zh-cn_topic_0160619034_p1340726101620"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p9565710261"><a name="p9565710261"></a><a name="p9565710261"></a>在线服务实例部署的虚拟私有云ID，默认为空，此时ModelArts会为每个用户分配一个专属的VPC，用户之间隔离；如需要在服务实例中访问名下VPC内的其他服务组件，则可配置此参数为对应VPC的ID。</p>
<p id="zh-cn_topic_0160619034_p23404269166"><a name="zh-cn_topic_0160619034_p23404269166"></a><a name="zh-cn_topic_0160619034_p23404269166"></a>VPC一旦配置，不支持修改。当vpc_id与cluster_id一同配置时，只有专属集群参数生效。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row957220334161"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p16572153315160"><a name="zh-cn_topic_0160619034_p16572153315160"></a><a name="zh-cn_topic_0160619034_p16572153315160"></a>subnet_network_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p3572163313168"><a name="zh-cn_topic_0160619034_p3572163313168"></a><a name="zh-cn_topic_0160619034_p3572163313168"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p5572143391611"><a name="zh-cn_topic_0160619034_p5572143391611"></a><a name="zh-cn_topic_0160619034_p5572143391611"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p2572933181610"><a name="zh-cn_topic_0160619034_p2572933181610"></a><a name="zh-cn_topic_0160619034_p2572933181610"></a>子网的网络ID，默认为空，当配置了vpc_id则此参数必填。需填写虚拟私有云控制台子网详情中显示的“网络ID”。通过子网可提供与其他网络隔离的、可以独享的网络资源。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row295516219164"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p8956132151619"><a name="zh-cn_topic_0160619034_p8956132151619"></a><a name="zh-cn_topic_0160619034_p8956132151619"></a>security_group_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p15956122161615"><a name="zh-cn_topic_0160619034_p15956122161615"></a><a name="zh-cn_topic_0160619034_p15956122161615"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p295632112162"><a name="zh-cn_topic_0160619034_p295632112162"></a><a name="zh-cn_topic_0160619034_p295632112162"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1595642161617"><a name="zh-cn_topic_0160619034_p1595642161617"></a><a name="zh-cn_topic_0160619034_p1595642161617"></a>安全组，默认为空，当配置了vpc_id则此参数必填。安全组起着虚拟防火墙的作用，为服务实例提供安全的网络访问控制策略。安全组须包含至少一条入方向规则，对协议为TCP、源地址为0.0.0.0/0、端口为8080的请求放行。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1477965462320"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1678119545237"><a name="zh-cn_topic_0160619034_p1678119545237"></a><a name="zh-cn_topic_0160619034_p1678119545237"></a>configs</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p12784165413231"><a name="zh-cn_topic_0160619034_p12784165413231"></a><a name="zh-cn_topic_0160619034_p12784165413231"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1378505482320"><a name="zh-cn_topic_0160619034_p1378505482320"></a><a name="zh-cn_topic_0160619034_p1378505482320"></a>包括predictor configs结构和transformer configs</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p171811636162510"><a name="p171811636162510"></a><a name="p171811636162510"></a>模型运行配置。</p>
<a name="ul4744163702515"></a><a name="ul4744163702515"></a><ul id="ul4744163702515"><li>当推理方式为batch/edge时仅支持配置一个模型。</li><li>当推理方式为real-time时，可根据业务需要配置多个模型并分配权重，但多个模型的版本号不能相同</li></ul>
</td>
</tr>
<tr id="row1907759164415"><td class="cellrowborder" valign="top" width="15.340000000000002%" headers="mcps1.2.5.1.1 "><p id="p16306103103120"><a name="p16306103103120"></a><a name="p16306103103120"></a>schedule</p>
</td>
<td class="cellrowborder" valign="top" width="9.75%" headers="mcps1.2.5.1.2 "><p id="p23067311315"><a name="p23067311315"></a><a name="p23067311315"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="12.85%" headers="mcps1.2.5.1.3 "><p id="p13306173173111"><a name="p13306173173111"></a><a name="p13306173173111"></a>schedule结构数组</p>
</td>
<td class="cellrowborder" valign="top" width="62.06%" headers="mcps1.2.5.1.4 "><p id="p33061130310"><a name="p33061130310"></a><a name="p33061130310"></a>服务调度配置，仅在线服务可配置，默认不使用，服务长期运行。请参见<a href="#table1892915349285">表6</a>。</p>
</td>
</tr>
</tbody>
</table>

**表 3**  predictor configs结构

<a name="zh-cn_topic_0160619034_table6841887256"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row4846788252"><th class="cellrowborder" valign="top" width="11.742574257425742%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p884819812515"><a name="zh-cn_topic_0160619034_p884819812515"></a><a name="zh-cn_topic_0160619034_p884819812515"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="7.524752475247524%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p1985013812252"><a name="zh-cn_topic_0160619034_p1985013812252"></a><a name="zh-cn_topic_0160619034_p1985013812252"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="14.85148514851485%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p1852188192520"><a name="zh-cn_topic_0160619034_p1852188192520"></a><a name="zh-cn_topic_0160619034_p1852188192520"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="65.88118811881188%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p38538832514"><a name="zh-cn_topic_0160619034_p38538832514"></a><a name="zh-cn_topic_0160619034_p38538832514"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row1856380258"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1786010872513"><a name="zh-cn_topic_0160619034_p1786010872513"></a><a name="zh-cn_topic_0160619034_p1786010872513"></a>model_id</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p386268152512"><a name="zh-cn_topic_0160619034_p386268152512"></a><a name="zh-cn_topic_0160619034_p386268152512"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p1386419814252"><a name="zh-cn_topic_0160619034_p1386419814252"></a><a name="zh-cn_topic_0160619034_p1386419814252"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p9866118172511"><a name="zh-cn_topic_0160619034_p9866118172511"></a><a name="zh-cn_topic_0160619034_p9866118172511"></a>模型ID。<span class="parmvalue" id="parmvalue3708192084010"><a name="parmvalue3708192084010"></a><a name="parmvalue3708192084010"></a>“model_id”</span>可以通过<a href="查询模型列表.md">查询模型列表</a>或者ModelArts管理控制台获取。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1086798112511"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p986916812517"><a name="zh-cn_topic_0160619034_p986916812517"></a><a name="zh-cn_topic_0160619034_p986916812517"></a>weight</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p687111819259"><a name="zh-cn_topic_0160619034_p687111819259"></a><a name="zh-cn_topic_0160619034_p687111819259"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p138731787259"><a name="zh-cn_topic_0160619034_p138731787259"></a><a name="zh-cn_topic_0160619034_p138731787259"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p19875118162511"><a name="zh-cn_topic_0160619034_p19875118162511"></a><a name="zh-cn_topic_0160619034_p19875118162511"></a>权重百分比，分配到此模型的流量权重，仅当infer_type为real-time时需要配置，多个权重相加必须等于100；当在一个在线服务中同时配置了多个模型版本且设置不同的流量权重比例时，持续地访问此服务的预测接口，ModelArts会按此权重比例将预测请求转发到对应的模型版本实例。</p>
<pre class="screen" id="screen1095381218159"><a name="screen1095381218159"></a><a name="screen1095381218159"></a>{
"service_name": "mnist",
"description": "mnist service",
"infer_type": "real-time",
"config": [
{
"model_id": "xxxmodel-idxxx",
"weight": "70",
"specification": "modelarts.vm.cpu.2u",
"instance_count": 1,
"envs":
{
"model_name": "mxnet-model-1",
"load_epoch": "0"
}
},
{
"model_id": "xxxxxx",
"weight": "30",
"specification": "modelarts.vm.cpu.2u",
"instance_count": 1
}
]
}</pre>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row1687613842514"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1187828182513"><a name="zh-cn_topic_0160619034_p1187828182513"></a><a name="zh-cn_topic_0160619034_p1187828182513"></a>specification</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p38801282251"><a name="zh-cn_topic_0160619034_p38801282251"></a><a name="zh-cn_topic_0160619034_p38801282251"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p08821882254"><a name="zh-cn_topic_0160619034_p08821882254"></a><a name="zh-cn_topic_0160619034_p08821882254"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p152111045125813"><a name="zh-cn_topic_0160619034_p152111045125813"></a><a name="zh-cn_topic_0160619034_p152111045125813"></a>资源规格，当前版本可选modelarts.vm.cpu.2u/modelarts.vm.gpu.p4(需申请)/modelarts.vm.ai1.a310(需申请)，需申请权限才能使用的规格请在华为云创建工单，由ModelArts运维工程师添加权限。当取值为“local”时，即为在本地推理，请参见<a href="服务调试.md#zh-cn_topic_0160619034_table37462542238">部署本地Predictor说明</a>。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row988558102512"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1588814812519"><a name="zh-cn_topic_0160619034_p1588814812519"></a><a name="zh-cn_topic_0160619034_p1588814812519"></a>instance_count</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p68902872512"><a name="zh-cn_topic_0160619034_p68902872512"></a><a name="zh-cn_topic_0160619034_p68902872512"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p18926812256"><a name="zh-cn_topic_0160619034_p18926812256"></a><a name="zh-cn_topic_0160619034_p18926812256"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1253075612589"><a name="zh-cn_topic_0160619034_p1253075612589"></a><a name="zh-cn_topic_0160619034_p1253075612589"></a>模型部署的实例数，当前限制最大实例数为5，如需使用更多的实例数，需提交工单申请。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row208952088256"><td class="cellrowborder" valign="top" width="11.742574257425742%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p48972820252"><a name="zh-cn_topic_0160619034_p48972820252"></a><a name="zh-cn_topic_0160619034_p48972820252"></a>envs</p>
</td>
<td class="cellrowborder" valign="top" width="7.524752475247524%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1889910820252"><a name="zh-cn_topic_0160619034_p1889910820252"></a><a name="zh-cn_topic_0160619034_p1889910820252"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.85148514851485%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p119011483251"><a name="zh-cn_topic_0160619034_p119011483251"></a><a name="zh-cn_topic_0160619034_p119011483251"></a>Map&lt;String, String&gt;</p>
</td>
<td class="cellrowborder" valign="top" width="65.88118811881188%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p590416818251"><a name="zh-cn_topic_0160619034_p590416818251"></a><a name="zh-cn_topic_0160619034_p590416818251"></a>运行模型需要的环境变量键值对，可选填，默认为空。</p>
</td>
</tr>
</tbody>
</table>

**表 4**  transformer configs结构

<a name="zh-cn_topic_0160619034_table6420928063"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row12420102810614"><th class="cellrowborder" valign="top" width="12.574257425742575%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p164282280612"><a name="zh-cn_topic_0160619034_p164282280612"></a><a name="zh-cn_topic_0160619034_p164282280612"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="9.128712871287128%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p1442892817613"><a name="zh-cn_topic_0160619034_p1442892817613"></a><a name="zh-cn_topic_0160619034_p1442892817613"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="14.782178217821782%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p942814289610"><a name="zh-cn_topic_0160619034_p942814289610"></a><a name="zh-cn_topic_0160619034_p942814289610"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="63.51485148514852%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p342819281067"><a name="zh-cn_topic_0160619034_p342819281067"></a><a name="zh-cn_topic_0160619034_p342819281067"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row242862813615"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1042811281364"><a name="zh-cn_topic_0160619034_p1042811281364"></a><a name="zh-cn_topic_0160619034_p1042811281364"></a>model_id</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1343542810611"><a name="zh-cn_topic_0160619034_p1343542810611"></a><a name="zh-cn_topic_0160619034_p1343542810611"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p643515281612"><a name="zh-cn_topic_0160619034_p643515281612"></a><a name="zh-cn_topic_0160619034_p643515281612"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p144351289614"><a name="zh-cn_topic_0160619034_p144351289614"></a><a name="zh-cn_topic_0160619034_p144351289614"></a>模型ID。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row644311283615"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1444316281614"><a name="zh-cn_topic_0160619034_p1444316281614"></a><a name="zh-cn_topic_0160619034_p1444316281614"></a>specification</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p1745022815613"><a name="zh-cn_topic_0160619034_p1745022815613"></a><a name="zh-cn_topic_0160619034_p1745022815613"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p124501281565"><a name="zh-cn_topic_0160619034_p124501281565"></a><a name="zh-cn_topic_0160619034_p124501281565"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1192195463517"><a name="zh-cn_topic_0160619034_p1192195463517"></a><a name="zh-cn_topic_0160619034_p1192195463517"></a>资源规格，当前版本可选modelarts.vm.cpu.2u/modelarts.vm.gpu.p4。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row104508285618"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p645020286620"><a name="zh-cn_topic_0160619034_p645020286620"></a><a name="zh-cn_topic_0160619034_p645020286620"></a>instance_count</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p104501028868"><a name="zh-cn_topic_0160619034_p104501028868"></a><a name="zh-cn_topic_0160619034_p104501028868"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p545910281362"><a name="zh-cn_topic_0160619034_p545910281362"></a><a name="zh-cn_topic_0160619034_p545910281362"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p1745912811612"><a name="zh-cn_topic_0160619034_p1745912811612"></a><a name="zh-cn_topic_0160619034_p1745912811612"></a>模型部署的实例数，邀测阶段取值范围[1, 2]。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row245911284618"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p174598287617"><a name="zh-cn_topic_0160619034_p174598287617"></a><a name="zh-cn_topic_0160619034_p174598287617"></a>envs</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p194590281468"><a name="zh-cn_topic_0160619034_p194590281468"></a><a name="zh-cn_topic_0160619034_p194590281468"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p204591928064"><a name="zh-cn_topic_0160619034_p204591928064"></a><a name="zh-cn_topic_0160619034_p204591928064"></a>Map&lt;String, String&gt;</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p14459202819615"><a name="zh-cn_topic_0160619034_p14459202819615"></a><a name="zh-cn_topic_0160619034_p14459202819615"></a>运行模型需要的环境变量键值对，可选填，默认为空。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row27917187920"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p27919181917"><a name="zh-cn_topic_0160619034_p27919181917"></a><a name="zh-cn_topic_0160619034_p27919181917"></a>src_path</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p37921815919"><a name="zh-cn_topic_0160619034_p37921815919"></a><a name="zh-cn_topic_0160619034_p37921815919"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p2791818799"><a name="zh-cn_topic_0160619034_p2791818799"></a><a name="zh-cn_topic_0160619034_p2791818799"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p137911181899"><a name="zh-cn_topic_0160619034_p137911181899"></a><a name="zh-cn_topic_0160619034_p137911181899"></a>批量任务输入数据的OBS路径。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row924312220920"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p13250162218914"><a name="zh-cn_topic_0160619034_p13250162218914"></a><a name="zh-cn_topic_0160619034_p13250162218914"></a>dest_path</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p152505229917"><a name="zh-cn_topic_0160619034_p152505229917"></a><a name="zh-cn_topic_0160619034_p152505229917"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p122507220919"><a name="zh-cn_topic_0160619034_p122507220919"></a><a name="zh-cn_topic_0160619034_p122507220919"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p647112917104"><a name="zh-cn_topic_0160619034_p647112917104"></a><a name="zh-cn_topic_0160619034_p647112917104"></a>批量任务输出结果的OBS路径。</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row62328563176"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1823215618175"><a name="zh-cn_topic_0160619034_p1823215618175"></a><a name="zh-cn_topic_0160619034_p1823215618175"></a>req_uri</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p16234125681718"><a name="zh-cn_topic_0160619034_p16234125681718"></a><a name="zh-cn_topic_0160619034_p16234125681718"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p18234205618176"><a name="zh-cn_topic_0160619034_p18234205618176"></a><a name="zh-cn_topic_0160619034_p18234205618176"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p15991750134316"><a name="zh-cn_topic_0160619034_p15991750134316"></a><a name="zh-cn_topic_0160619034_p15991750134316"></a>批量任务中调用的推理接口，即模型镜像中暴露的REST接口，需要从模型的config.json文件中选取一个api路径用于此次推理；如使用ModelArts提供的预置推理镜像，则此接口为/</p>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row285695891717"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1085645820173"><a name="zh-cn_topic_0160619034_p1085645820173"></a><a name="zh-cn_topic_0160619034_p1085645820173"></a>mapping_type</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p18856115816179"><a name="zh-cn_topic_0160619034_p18856115816179"></a><a name="zh-cn_topic_0160619034_p18856115816179"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p585614581175"><a name="zh-cn_topic_0160619034_p585614581175"></a><a name="zh-cn_topic_0160619034_p585614581175"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="p18859132072910"><a name="p18859132072910"></a><a name="p18859132072910"></a>输入数据的映射类型，可选<span class="parmvalue" id="parmvalue3107174115293"><a name="parmvalue3107174115293"></a><a name="parmvalue3107174115293"></a>“file”</span>或<span class="parmvalue" id="parmvalue7765164314294"><a name="parmvalue7765164314294"></a><a name="parmvalue7765164314294"></a>“csv”</span>。</p>
<a name="ul9992152211292"></a><a name="ul9992152211292"></a><ul id="ul9992152211292"><li>file指每个推理请求对应到输入数据目录下的一个文件，当使用此方式时，此模型对应req_uri只能有一个输入参数且此参数的类型是file。</li><li>csv指每个推理请求对应到csv里的一行数据，当使用此方式时，输入数据目录下的文件只能以.csv为后缀，且需配置mapping_rule参数，以表达推理请求体中各个参数对应到csv的索引。</li></ul>
<p id="zh-cn_topic_0160619034_p1567374319574"><a name="zh-cn_topic_0160619034_p1567374319574"></a><a name="zh-cn_topic_0160619034_p1567374319574"></a>创建批量服务且输入数据映射方式为file的样例</p>
<pre class="screen" id="screen14511328131218"><a name="screen14511328131218"></a><a name="screen14511328131218"></a>{
"service_name": "batchservicetest",
"description": "",
"infer_type": "batch",
"config": [{
"model_id": "598b913a-af3e-41ba-a1b5-bf065320f1e2",
"specification": "modelarts.vm.cpu.2u",
"instance_count": 1,
"src_path": "https://infers-data.obs.myhuaweicloud.com/xgboosterdata/",
"dest_path": "https://infers-data.obs.myhuaweicloud.com/output/",
"req_uri": "/",
"mapping_type": "file"
}]
}</pre>
<p id="zh-cn_topic_0160619034_p17786115845719"><a name="zh-cn_topic_0160619034_p17786115845719"></a><a name="zh-cn_topic_0160619034_p17786115845719"></a>创建批量服务且输入数据映射方式为csv的样例</p>
<pre class="screen" id="screen35651039171215"><a name="screen35651039171215"></a><a name="screen35651039171215"></a>{
"service_name": "batchservicetest",
"description": "",
"infer_type": "batch",
"config": [{
"model_id": "598b913a-af3e-41ba-a1b5-bf065320f1e2",
"specification": "modelarts.vm.cpu.2u",
"instance_count": 1,
"src_path": "https://infers-data.obs.myhuaweicloud.com/xgboosterdata/",
"dest_path": "https://infers-data.obs.myhuaweicloud.com/output/",
"req_uri": "/",
"mapping_type": "csv",
"mapping_rule": {
"type": "object",
"properties": {
"data": {
"type": "object",
"properties": {
"req_data": {
"type": "array",
"items": [{
"type": "object",
"properties": {
"input5": {
"type": "number",
"index": 0
},
"input4": {
"type": "number",
"index": 1
},
"input3": {
"type": "number",
"index": 2
},
"input2": {
"type": "number",
"index": 3
},
"input1": {
"type": "number",
"index": 4
}
}
}]
}
}
}
}
}
}]
}</pre>
</td>
</tr>
<tr id="zh-cn_topic_0160619034_row158141118183"><td class="cellrowborder" valign="top" width="12.574257425742575%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p481416131817"><a name="zh-cn_topic_0160619034_p481416131817"></a><a name="zh-cn_topic_0160619034_p481416131817"></a>mapping_rule</p>
</td>
<td class="cellrowborder" valign="top" width="9.128712871287128%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p188141813180"><a name="zh-cn_topic_0160619034_p188141813180"></a><a name="zh-cn_topic_0160619034_p188141813180"></a>否</p>
</td>
<td class="cellrowborder" valign="top" width="14.782178217821782%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p178147119189"><a name="zh-cn_topic_0160619034_p178147119189"></a><a name="zh-cn_topic_0160619034_p178147119189"></a>Map</p>
</td>
<td class="cellrowborder" valign="top" width="63.51485148514852%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p12814018180"><a name="zh-cn_topic_0160619034_p12814018180"></a><a name="zh-cn_topic_0160619034_p12814018180"></a>输入参数与csv数据的映射关系，仅当mapping_type为csv时需要填写。映射规则与模型配置文件config.json中输入参数的定义方式相似，只需要在每一个基本类型（string/number/integer/boolean）的参数下配置index参数，指定使用csv数据中对应索引下标的数据作为此参数的值去发送推理请求，csv数据必须以英文半角逗号分隔，index从0开始计数，特殊地，当index为-1时忽略此参数，具体请参见<a href="#zh-cn_topic_0160619034_li10567114011171">部署transformer的示例代码</a>的样例。</p>
<p id="zh-cn_topic_0160619034_p16246141718588"><a name="zh-cn_topic_0160619034_p16246141718588"></a><a name="zh-cn_topic_0160619034_p16246141718588"></a>样例中mapping_rule描述的推理请求体格式为：</p>
<pre class="screen" id="screen14553182221617"><a name="screen14553182221617"></a><a name="screen14553182221617"></a>{
"data": {
"req_data": [{
"input1": 1,
"input2": 2,
"input3": 3,
"input4": 4,
"input5": 5
}]
}
}</pre>
</td>
</tr>
</tbody>
</table>

**表 5**  部署predictor和transformer返回参数说明

<a name="zh-cn_topic_0160619034_table19248816291"></a>
<table><thead align="left"><tr id="zh-cn_topic_0160619034_row092468182915"><th class="cellrowborder" valign="top" width="12.659999999999998%" id="mcps1.2.5.1.1"><p id="zh-cn_topic_0160619034_p119241181292"><a name="zh-cn_topic_0160619034_p119241181292"></a><a name="zh-cn_topic_0160619034_p119241181292"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="7.13%" id="mcps1.2.5.1.2"><p id="zh-cn_topic_0160619034_p189248810294"><a name="zh-cn_topic_0160619034_p189248810294"></a><a name="zh-cn_topic_0160619034_p189248810294"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="15.22%" id="mcps1.2.5.1.3"><p id="zh-cn_topic_0160619034_p39246812913"><a name="zh-cn_topic_0160619034_p39246812913"></a><a name="zh-cn_topic_0160619034_p39246812913"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="64.99000000000001%" id="mcps1.2.5.1.4"><p id="zh-cn_topic_0160619034_p16924148142918"><a name="zh-cn_topic_0160619034_p16924148142918"></a><a name="zh-cn_topic_0160619034_p16924148142918"></a>描述</p>
</th>
</tr>
</thead>
<tbody><tr id="zh-cn_topic_0160619034_row1392418102915"><td class="cellrowborder" valign="top" width="12.659999999999998%" headers="mcps1.2.5.1.1 "><p id="zh-cn_topic_0160619034_p1892488192918"><a name="zh-cn_topic_0160619034_p1892488192918"></a><a name="zh-cn_topic_0160619034_p1892488192918"></a>predictor</p>
</td>
<td class="cellrowborder" valign="top" width="7.13%" headers="mcps1.2.5.1.2 "><p id="zh-cn_topic_0160619034_p492438142911"><a name="zh-cn_topic_0160619034_p492438142911"></a><a name="zh-cn_topic_0160619034_p492438142911"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="15.22%" headers="mcps1.2.5.1.3 "><p id="zh-cn_topic_0160619034_p11924108162919"><a name="zh-cn_topic_0160619034_p11924108162919"></a><a name="zh-cn_topic_0160619034_p11924108162919"></a>Predictor对象</p>
</td>
<td class="cellrowborder" valign="top" width="64.99000000000001%" headers="mcps1.2.5.1.4 "><p id="zh-cn_topic_0160619034_p19924118192917"><a name="zh-cn_topic_0160619034_p19924118192917"></a><a name="zh-cn_topic_0160619034_p19924118192917"></a>Predictor对象，其属性描述包括服务管理章节全部功能。</p>
</td>
</tr>
</tbody>
</table>

**表 6**  schedule结构

<a name="table1892915349285"></a>
<table><thead align="left"><tr id="row9929133418283"><th class="cellrowborder" valign="top" width="19.801980198019802%" id="mcps1.2.5.1.1"><p id="p7929113442813"><a name="p7929113442813"></a><a name="p7929113442813"></a>参数</p>
</th>
<th class="cellrowborder" valign="top" width="7.920792079207921%" id="mcps1.2.5.1.2"><p id="p49301534192811"><a name="p49301534192811"></a><a name="p49301534192811"></a>是否必选</p>
</th>
<th class="cellrowborder" valign="top" width="18.81188118811881%" id="mcps1.2.5.1.3"><p id="p199305340285"><a name="p199305340285"></a><a name="p199305340285"></a>参数类型</p>
</th>
<th class="cellrowborder" valign="top" width="53.46534653465347%" id="mcps1.2.5.1.4"><p id="p7930173472812"><a name="p7930173472812"></a><a name="p7930173472812"></a>说明</p>
</th>
</tr>
</thead>
<tbody><tr id="row1893015341284"><td class="cellrowborder" valign="top" width="19.801980198019802%" headers="mcps1.2.5.1.1 "><p id="p15930834142811"><a name="p15930834142811"></a><a name="p15930834142811"></a>op_type</p>
</td>
<td class="cellrowborder" valign="top" width="7.920792079207921%" headers="mcps1.2.5.1.2 "><p id="p19930434162810"><a name="p19930434162810"></a><a name="p19930434162810"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="18.81188118811881%" headers="mcps1.2.5.1.3 "><p id="p15930193412820"><a name="p15930193412820"></a><a name="p15930193412820"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="53.46534653465347%" headers="mcps1.2.5.1.4 "><p id="p1393083414285"><a name="p1393083414285"></a><a name="p1393083414285"></a>调度类型，当前仅支持取值为<span class="parmvalue" id="parmvalue76857664114"><a name="parmvalue76857664114"></a><a name="parmvalue76857664114"></a>“stop”</span>。</p>
</td>
</tr>
<tr id="row179301634112811"><td class="cellrowborder" valign="top" width="19.801980198019802%" headers="mcps1.2.5.1.1 "><p id="p1593053482815"><a name="p1593053482815"></a><a name="p1593053482815"></a>time_unit</p>
</td>
<td class="cellrowborder" valign="top" width="7.920792079207921%" headers="mcps1.2.5.1.2 "><p id="p10930133402815"><a name="p10930133402815"></a><a name="p10930133402815"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="18.81188118811881%" headers="mcps1.2.5.1.3 "><p id="p129301334162818"><a name="p129301334162818"></a><a name="p129301334162818"></a>String</p>
</td>
<td class="cellrowborder" valign="top" width="53.46534653465347%" headers="mcps1.2.5.1.4 "><p id="p171491712114110"><a name="p171491712114110"></a><a name="p171491712114110"></a>调度时间单位，可选：</p>
<a name="ul205311014184113"></a><a name="ul205311014184113"></a><ul id="ul205311014184113"><li>DAYS</li><li>HOURS</li><li>MINUTES</li></ul>
</td>
</tr>
<tr id="row89301634162818"><td class="cellrowborder" valign="top" width="19.801980198019802%" headers="mcps1.2.5.1.1 "><p id="p39301334172816"><a name="p39301334172816"></a><a name="p39301334172816"></a>duration</p>
</td>
<td class="cellrowborder" valign="top" width="7.920792079207921%" headers="mcps1.2.5.1.2 "><p id="p1293093442817"><a name="p1293093442817"></a><a name="p1293093442817"></a>是</p>
</td>
<td class="cellrowborder" valign="top" width="18.81188118811881%" headers="mcps1.2.5.1.3 "><p id="p12930734202819"><a name="p12930734202819"></a><a name="p12930734202819"></a>Integer</p>
</td>
<td class="cellrowborder" valign="top" width="53.46534653465347%" headers="mcps1.2.5.1.4 "><p id="p753864762914"><a name="p753864762914"></a><a name="p753864762914"></a>对应时间单位的数值，比如2小时后停止，则<span class="parmname" id="parmname1239513004115"><a name="parmname1239513004115"></a><a name="parmname1239513004115"></a>“time_unit”</span>填<span class="parmvalue" id="parmvalue1323013404119"><a name="parmvalue1323013404119"></a><a name="parmvalue1323013404119"></a>“HOURS”</span>，<span class="parmname" id="parmname1730833717419"><a name="parmname1730833717419"></a><a name="parmname1730833717419"></a>“duration”</span>填<span class="parmvalue" id="parmvalue615274034111"><a name="parmvalue615274034111"></a><a name="parmvalue615274034111"></a>“2”</span>。</p>
</td>
</tr>
</tbody>
</table>

>![](public_sys-resources/icon-note.gif) **说明：** 
>-   **给出MXNet实现手写数字识别项目中部署在线predictror实例：**
>    ```
>    from modelarts.session import Session
>    from modelarts.model import Model
>    from modelarts.config.model_config import ServiceConfig,TransformerConfig 
>    model_instance = Model(session, model_id = "input you model id")
>    configs = []
>    config1 = ServiceConfig(model_id="input you model id", 
>                            weight="100", 
>                            instance_count=1, 
>                            specification="modelarts.vm.cpu.2u",
>                            envs={"input_data_name":"images",
>                                  "input_data_shape":"0,1,28,28",
>                                  "output_data_shape":"0,10"})
>    configs.append(config1)
>    predictor = model_instance.deploy_predictor(service_name="DigitRecognition", configs=configs)
>    ```
>-   **给出MXNet实现手写数字识别项目中部署transformer实例（批推理）：**
>    ```
>    from modelarts.session import Session
>    from modelarts.model import Model
>    from modelarts.config.model_config import ServiceConfig,TransformerConfig
>    model_instance = Model(session, model_id = "input your model id") 
>    configs = []
>    config1 = TransformerConfig(model_id="input your model id", 
>                                specification="modelarts.vm.cpu.2u", 
>                                instance_count=1, 
>                                envs={"input_data_name":"images","input_data_shape":"0,1,28,28","output_data_shape":"0,10"},
>                                src_path="/w0403/testdigitrecognition/inferimages/",
>                                dest_path="/w0403/testdigitrecognition/" ,
>                                req_uri = "/",
>                                mapping_type = "file")
>    configs.append(config1)
>    predictor = model_instance.deploy_transformer(service_name="DigitRecognition", infer_type="batch", configs=configs)
>    ```

